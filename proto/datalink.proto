syntax = "proto3";

package datalink;

option go_package = "seminarska/proto/datalink";

import "razpravljalnica.proto";

enum Operation {
  Create = 0;
  Update = 1;
  Delete = 2;
}

message Message {
  int32 message_index = 1;
  string request_id = 2; // used to identify the message independently of its index (which is not immediately known)
  Operation op = 3;
  oneof payload {
    razpravljalnica.User user = 4;
    razpravljalnica.Topic topic = 5;
    razpravljalnica.Message message = 6;
    razpravljalnica.Like like = 7;
  }
}

message Confirmation {
  int32 message_index = 1;
  string request_id = 2;
  bool ok = 3;
  string error = 4;
}

service DataLink {

  // TODO: sync()

  rpc Replicate(stream Message) returns (stream Confirmation);
}
