syntax = "proto3";

package datalink;

option go_package = "seminarska/proto/datalink";

import "razpravljalnica.proto";

enum Operation {
  Create = 0;
  Update = 1;
  Delete = 2;
}

message Message {
  int32 message_id = 1;
  Operation op = 2;
  oneof payload {
    razpravljalnica.User user = 3;
    razpravljalnica.Topic topic = 4;
    razpravljalnica.Message message = 5;
    razpravljalnica.Like like = 6;
  }
}

message Confirmation {
  int32 message_id = 1;
  bool ok = 2;
  optional string error = 3;
}

service DataLink {

  // TODO: sync()

  rpc Replicate(stream Message) returns (stream Confirmation);
}
